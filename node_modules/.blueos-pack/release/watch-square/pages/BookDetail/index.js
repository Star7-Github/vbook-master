let n={"@info":{styleObjectId:1227805737}};const p=n,s=$app_require$("@app-module/system.router"),i=$app_require$("@app-module/system.prompt"),a=$app_require$("@app-module/system.file"),r={data:function(){return{bookId:"",bookName:"",chapterCount:0,currentChapter:0,rawUri:"",isLocal:!1,content:"",isDeleting:!1}},onInit(){console.log("书籍详情页 初始化",this.bookName),typeof this.isLocal=="string"&&(this.isLocal=this.isLocal==="true")},computed:{progressPercent(){const o=Number(this.currentChapter)||0,t=Number(this.chapterCount)||1;if(t<=0)return 0;let e=Math.floor((o+1)*100/t);return e>100&&(e=100),e}},startReading(){this.isLocal?s.push({uri:"pages/Reader",params:{title:this.bookName,content:this.content,bookId:"local_"+this.bookName}}):s.push({uri:"pages/Reader",params:{bookId:this.bookId,bookName:this.bookName,chapterIndex:this.currentChapter,chapterCount:this.chapterCount}})},handleDelete(){if(this.isLocal){i.showToast({message:"内置书籍无法删除"});return}this.isDeleting||(this.isDeleting=!0,i.showToast({message:"删除中..."}),this.doDeleteFiles())},doDeleteFiles(){console.log(`[BookDetail] Deleting book: ${this.bookId}`),this.$app&&this.$app.$def&&this.$app.$def.clearTask&&this.$app.$def.clearTask(this.bookId);const o=this.rawUri||`internal://files/book_${this.bookId}.json`;if(a.delete({uri:o,success:()=>console.log("[BookDetail] Meta deleted"),fail:(t,e)=>console.log(`[BookDetail] Meta delete fail: ${e}`)}),this.bookId){const t=`internal://files/book_data_${this.bookId}`;a.rmdir({uri:t,recursive:!0,success:()=>console.log("[BookDetail] Content folder deleted"),fail:(e,l)=>console.log(`[BookDetail] Content folder delete fail: ${l}`)})}setTimeout(()=>{this.isDeleting=!1,i.showToast({message:"删除成功"}),s.back()},2e3)}};$app_define$("@app-component/index",[],function(o,t,e){e.exports=r.default||r,e.exports.style=p});$app_bootstrap$("@app-component/index");
