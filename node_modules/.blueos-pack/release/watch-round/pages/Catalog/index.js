let p={"@info":{styleObjectId:937831808}};const l=p,n=$app_require$("@app-module/system.router"),r=$app_require$("@app-module/system.file"),c=$app_require$("@app-module/system.prompt"),h={data:function(){return{bookId:"",bookName:"",currentIndex:-1,totalCount:0,pageSize:50,isLoading:!0,showRanges:!0,ranges:[],chapters:[],allChaptersMeta:[]}},computed:{titleText(){return this.showRanges?"目录-选择分页":"目录"}},onInit(){this.currentIndex=parseInt(this.currentIndex)||0,this.loadMeta()},async loadMeta(){const e=`internal://files/book_${this.bookId}.json`;try{const s=await this.readText(e);if(s){const t=JSON.parse(s);this.totalCount=parseInt(t.chapterCount)||0,Array.isArray(t.chapters)&&(this.allChaptersMeta=t.chapters)}}catch{console.log("Read meta failed")}if(this.totalCount===0){this.isLoading=!1,c.showToast({message:"暂无目录数据"});return}this.totalCount>this.pageSize?(this.showRanges=!0,this.generateRanges()):(this.showRanges=!1,this.loadChapters(0,this.totalCount)),this.isLoading=!1},generateRanges(){const e=[],s=Math.ceil(this.totalCount/this.pageSize);for(let t=0;t<s;t++){const i=t*this.pageSize+1,a=Math.min((t+1)*this.pageSize,this.totalCount);e.push({label:`${i} - ${a} 章`,startIndex:t*this.pageSize,count:a-t*this.pageSize})}this.ranges=e},loadChapters(e,s){const t=[];for(let i=0;i<s;i++){const a=e+i;let o=`第 ${a+1} 章`;this.allChaptersMeta&&this.allChaptersMeta[a]&&(o=this.allChaptersMeta[a].title||o),t.push({title:o,index:a,cached:!1})}this.chapters=t,this.checkCachedStatus(t)},async checkCachedStatus(e){const s=`internal://files/book_data_${this.bookId}`,t=await Promise.all(e.map(a=>this.checkFileExists(`${s}/${a.index}.txt`))),i=e.map((a,o)=>({...a,cached:t[o]}));this.chapters=i},checkFileExists(e){return new Promise(s=>r.access({uri:e,success:()=>s(!0),fail:()=>s(!1)}))},selectRange(e){const s=this.ranges[e];this.loadChapters(s.startIndex,s.count),this.showRanges=!1},handleBack(){!this.showRanges&&this.totalCount>this.pageSize?(this.showRanges=!0,this.chapters=[]):n.back()},readText(e){return new Promise(s=>{r.readText({uri:e,success:t=>s(t.text),fail:()=>s(null)})})},selectChapter(e){n.replace({uri:"/pages/Reader",params:{bookId:this.bookId,bookName:this.bookName,chapterIndex:e,chapterCount:this.totalCount}})}};$app_define$("@app-component/index",[],function(e,s,t){t.exports=h.default||h,t.exports.style=l});$app_bootstrap$("@app-component/index");
